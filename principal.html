<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Panel - DirtyDuties</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #f4f4f4;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      overflow-x: hidden;
    }

    .navbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #344f59;
      padding: 1rem 2rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 1000;
      height: 60px;
    }

    .navbar-logo {
      display: flex;
      align-items: center;
    }

    .app-name {
      color: #ffffff;
      font-weight: 600;
      font-size: 1.1rem;
    }

    .navbar nav {
      display: flex;
      align-items: center;
    }

    .navbar nav a {
      margin: 0 1rem;
      padding: 0.5rem;
      text-decoration: none;
      color: #ffffff;
      font-weight: 500;
      font-size: 1rem;
      transition: color 0.2s ease;
      cursor: pointer;
      position: relative;
    }

    .navbar nav a:hover {
      color: #7ff2ec;
    }

    .navbar nav a.active {
      color: #7ff2ec;
      border-bottom: 2px solid #7ff2ec;
    }

    .notification-badge {
      position: absolute;
      top: -5px;
      right: -15px;
      background: #ff4d4d;
      color: #ffffff;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      font-weight: bold;
    }

    .user-profile {
      display: flex;
      align-items: center;
      color: #ffffff;
      margin-right: 1rem;
      font-size: 1rem;
    }

    .user-profile::before {
      content: '👤';
      margin-right: 0.5rem;
    }

    .btn-salir {
      background: #7ff2ec;
      padding: 0.5rem 1rem;
      border: 1px solid #444;
      border-radius: 8px;
      text-decoration: none;
      color: black;
      font-weight: 500;
      font-size: 1rem;
      transition: background 0.2s ease;
    }

    .btn-salir:hover {
      background: #6ad9d3;
    }

    .menu-toggle {
      display: none;
      font-size: 1.5rem;
      color: #ffffff;
      background: none;
      border: none;
      cursor: pointer;
    }

    .sidebar {
      width: 300px;
      background: #344f59;
      color: #ffffff;
      position: fixed;
      top: 60px;
      left: 0;
      height: calc(100vh - 60px);
      padding: 1rem;
      box-shadow: 2px 0 5px rgba(0,0,0,0.1);
      z-index: 999;
      transition: transform 0.3s ease;
    }

    .sidebar h3 {
      margin-bottom: 1rem;
      font-size: 1.2rem;
      font-weight: 600;
    }

    .house-list {
      list-style: none;
      padding: 0;
      margin-bottom: 1rem;
    }

    .house-item {
      display: flex;
      align-items: center;
      padding: 0.5rem;
      margin-bottom: 0.5rem;
      background: #4a6775;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s ease;
    }

    .house-item:hover {
      background: #5a7d8c;
    }

    .house-item.active {
      background: #7ff2ec;
      color: #000000;
    }

    .house-item span {
      flex: 1;
      font-size: 1rem;
    }

    .house-item button {
      background: none;
      border: none;
      color: #ffffff;
      font-size: 0.9rem;
      margin-left: 0.5rem;
      cursor: pointer;
      transition: color 0.2s ease;
    }

    .house-item.active button {
      color: #000000;
    }

    .house-item button:hover {
      color: #ff6666;
    }

    .share-house-btn {
      background: none;
      border: none;
      color: #ffffff;
      font-size: 0.9rem;
      margin-left: 0.5rem;
      cursor: pointer;
    }

    .share-house-btn:hover {
      color: #7ff2ec;
    }

    .add-house-btn {
      display: block;
      width: 100%;
      padding: 0.5rem;
      background: #7ff2ec;
      border: 1px solid #444;
      border-radius: 8px;
      color: black;
      font-weight: 500;
      font-size: 1.2rem;
      text-align: center;
      cursor: pointer;
      transition: background 0.2s ease;
      margin-bottom: 1rem;
    }

    .add-house-btn:hover {
      background: #6ad9d3;
    }

    .sidebar-toggle {
      display: none;
      position: fixed;
      top: 61px;
      left: 1rem;
      font-size: 1.5rem;
      color: #ffffff;
      background: #344f59;
      border: none;
      border-radius: 8px;
      padding: 0.5rem;
      cursor: pointer;
      z-index: 1001;
    }

    main {
      flex: 1;
      width: 100%;
      margin-left: 300px;
      margin-top: 60px;
      max-width: calc(100% - 300px);
      min-height: calc(100vh - 120px);
      display: flex;
      flex-direction: column;
    }

    .content {
      padding: 1rem;
      flex: 1;
      display: none;
    }

    .content.active {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .top-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
    }

    .card {
      background: white;
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      overflow: auto;
    }

    .card h2 {
      margin-top: 0;
      color: #333;
      margin-bottom: 1rem;
    }

    .task-list, .person-list, .user-task-list, .notification-list, .punishment-list, .leaderboard-list {
      list-style: none;
      padding: 0;
      margin-bottom: 1rem;
    }

    .task-item, .person-item, .user-task-item, .notification-item, .punishment-item, .leaderboard-item {
      display: flex;
      align-items: center;
      padding: 0.5rem 0;
      font-size: 1rem;
    }

    .user-task-item input[type="checkbox"], .punishment-item input[type="checkbox"] {
      margin-right: 0.5rem;
      width: 1.2rem;
      height: 1.2rem;
      cursor: pointer;
    }

    .task-item.completed, .user-task-item.completed, .punishment-item.completed {
      text-decoration: line-through;
      color: #777;
    }

    .task-item span, .person-item span, .user-task-item span, .notification-item span, .punishment-item span, .leaderboard-item span {
      flex: 1;
      overflow-wrap: break-word;
    }

    .task-item .assignee, .person-item .assignee, .user-task-item .assignee, .notification-item .assignee {
      font-size: 0.9rem;
      color: #555;
      margin-left: 0.5rem;
    }

    .notification-item {
      background: #f0f8ff;
      padding: 0.5rem;
      border-radius: 8px;
      margin-bottom: 0.5rem;
      position: relative;
    }

    .notification-item button {
      background: #7ff2ec;
      border: none;
      border-radius: 4px;
      padding: 0.2rem 0.5rem;
      font-size: 0.8rem;
      cursor: pointer;
      margin-left: 0.5rem;
      transition: background 0.2s ease;
    }

    .notification-item button:hover {
      background: #6ad9d3;
    }

    .clear-all-btn {
      background: #7ff2ec;
      border: none;
      border-radius: 8px;
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
      cursor: pointer;
      transition: background 0.2s ease;
      margin-top: 0.5rem;
    }

    .clear-all-btn:hover {
      background: #6ad9d3;
    }

    .add-form {
      display: flex;
      flex-wrap: wrap;
      gap: 0.3rem;
      margin-top: 1rem;
      max-width: 100%;
    }

    .add-form input {
      flex: 1;
      padding: 0.3rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 0.9rem;
      max-width: 150px;
    }

    #new-person {
      padding: 0.6rem;
      font-size: 1.1rem;
      max-width: 200px;
    }

    .add-form button {
      background: #7ff2ec;
      padding: 0.3rem 0.8rem;
      border: 1px solid #444;
      border-radius: 8px;
      color: black;
      font-weight: 500;
      font-size: 0.9rem;
      cursor: pointer;
      transition: background 0.2s ease;
      max-width: 100px;
    }

    .add-form button:hover {
      background: #6ad9d3;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      grid-template-rows: repeat(5, auto);
      gap: 0.5rem;
      margin-top: 1rem;
    }

    .calendar-day {
      background: #7ff2ec;
      border-radius: 8px;
      padding: 0.5rem;
      text-align: center;
      font-size: 0.9rem;
      color: #000000;
      min-height: 60px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      transition: transform 0.2s ease, background 0.2s ease;
    }

    .calendar-day:hover {
      transform: scale(1.2);
      background: #5ed7d0;
    }

    .calendar-day span {
      display: block;
      margin-bottom: 0.2rem;
    }

    .calendar-day .task, .calendar-day .punishment {
      font-size: 0.8rem;
      color: #000000;
    }

    .footer {
      width: 100%;
      background: #344f59;
      padding: 1rem;
      text-align: center;
      font-size: 0.8rem;
      color: #ffffff;
      z-index: 998;
      height: 60px;
    }

    .copy-feedback {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #344f59;
      color: #ffffff;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      z-index: 1002;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .copy-feedback.show {
      opacity: 1;
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1002;
      display: none;
      justify-content: center;
      align-items: center;
      transition: opacity 0.3s ease;
    }

    .modal-overlay.active {
      display: flex;
      opacity: 1;
    }

    .house-modal, .task-delete-modal {
      background: white;
      padding: 2rem;
      border-radius: 12px;
      width: 90%;
      max-width: 600px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .house-modal h2, .task-delete-modal h2 {
      color: #333;
      margin-bottom: 1rem;
    }

    .house-modal input,
    .house-modal textarea {
      padding: 0.5rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 1rem;
      width: 100%;
    }

    .house-modal textarea {
      resize: vertical;
      min-height: 100px;
    }

    .modal-info {
      color: #555;
      font-size: 0.9rem;
      margin-bottom: 1rem;
    }

    .modal-actions {
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
    }

    .modal-actions button {
      padding: 0.5rem 1rem;
      border: 1px solid #444;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s ease;
    }

    .modal-actions .save-btn {
      background: #7ff2ec;
      color: black;
    }

    .modal-actions .save-btn:hover {
      background: #6ad9d3;
    }

    .modal-actions .cancel-btn,
    .modal-actions .delete-btn,
    .modal-actions .yes-btn,
    .modal-actions .no-btn {
      background: #f4f4f4;
      color: black;
    }

    .modal-actions .cancel-btn:hover,
    .modal-actions .no-btn:hover {
      background: #e0e0e0;
    }

    .modal-actions .delete-btn,
    .modal-actions .yes-btn {
      background: #ff6666;
      color: white;
    }

    .modal-actions .delete-btn:hover,
    .modal-actions .yes-btn:hover {
      background: #e55a5a;
    }

    .task-delete-modal p {
      color: #333;
      font-size: 1rem;
      margin-bottom: 1rem;
    }

    .punishment-details {
      display: none;
      margin-left: 2rem;
      padding: 0.5rem;
      background: #f0f8ff;
      border-radius: 4px;
      font-size: 0.9rem;
    }

    .punishment-details.active {
      display: block;
    }

    .toggle-details-btn {
      background: none;
      border: none;
      cursor: pointer;
      margin-left: 0.5rem;
      font-size: 1rem;
    }

    @media (max-width: 768px) {
      .navbar {
        flex-direction: column;
        padding: 1rem;
        height: auto;
      }

      .navbar-logo {
        width: 100%;
        justify-content: space-between;
        align-items: center;
      }

      .app-name {
        font-size: 1rem;
        margin-right: 0.5rem;
      }

      .navbar nav {
        display: none;
        flex-direction: column;
        width: 100%;
        margin-top: 1rem;
      }

      .navbar nav.active {
        display: flex;
      }

      .navbar nav a {
        margin: 0.5rem 0;
        text-align: center;
      }

      .notification-badge {
        top: -8px;
        right: -20px;
        width: 18px;
        height: 18px;
        font-size: 0.7rem;
      }

      .user-profile {
        margin-top: 0.5rem;
        margin-right: 0;
      }

      .btn-salir {
        margin-top: 1rem;
        width: 100%;
        text-align: center;
      }

      .menu-toggle {
        display: block;
      }

      .sidebar {
        transform: translateX(-100%);
        width: 250px;
        top: 60px;
        height: calc(100vh - 60px);
      }

      .sidebar.active {
        transform: translateX(0);
      }

      .sidebar-toggle {
        display: block;
        top: 61px;
      }

      main {
        margin-left: 0;
        margin-top: 60px;
        max-width: 100%;
        min-height: calc(100vh - 120px);
      }

      .content.active {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      .top-section {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      .card {
        padding: 1rem;
      }

      .add-form {
        flex-direction: column;
        gap: 0.5rem;
      }

      .add-form input,
      .add-form button {
        width: 100%;
        padding: 0.3rem;
        font-size: 0.9rem;
        max-width: none;
      }

      #new-person {
        padding: 0.6rem;
        font-size: 1.1rem;
      }

      .calendar-grid {
        gap: 0.3rem;
      }

      .calendar-day {
        padding: 0.3rem;
        min-height: 50px;
        font-size: 0.8rem;
      }

      .calendar-day:hover {
        transform: scale(1.1);
        background: #5ed7d0;
      }

      .calendar-day .task, .calendar-day .punishment {
        font-size: 0.7rem;
      }

      .notification-item button {
        padding: 0.1rem 0.3rem;
        font-size: 0.7rem;
      }

      .clear-all-btn {
        padding: 0.3rem 0.8rem;
        font-size: 0.8rem;
      }

      .house-modal, .task-delete-modal {
        width: 95%;
        padding: 1.5rem;
      }

      .punishment-details {
        margin-left: 1rem;
        font-size: 0.8rem;
      }
    }
  </style>
</head>
<body>
  <button class="sidebar-toggle" aria-label="Toggle sidebar">☰</button>

  <aside class="sidebar">
    <h3>Mis Casas</h3>
    <ul class="house-list" id="house-list">
      <li class="house-item active" data-house="Casa Salamanca">
        <span>Casa Salamanca</span>
        <button onclick="editHouse(this)">✏️</button>
        <button onclick="deleteHouse(this)">🗑️</button>
        <button onclick="shareHouse(this)">🔗</button>
      </li>
      <li class="house-item" data-house="Casa del Pueblo">
        <span>Casa del Pueblo</span>
        <button onclick="editHouse(this)">✏️</button>
        <button onclick="deleteHouse(this)">🗑️</button>
        <button onclick="shareHouse(this)">🔗</button>
      </li>
    </ul>
    <button class="add-house-btn" onclick="createHouse()">🞣</button>
  </aside>

  <header class="navbar">
    <div class="navbar-logo">
      <span class="app-name">DirtyDuties</span>
      <button class="menu-toggle" aria-label="Toggle menu">☰</button>
    </div>
    <nav>
      <a data-tab="mi-casa" class="active">Mi casa</a>
      <a data-tab="mis-tareas">Mis tareas</a>
      <a data-tab="mi-calendario">Mi calendario</a>
      <a data-tab="mis-notificaciones" id="notification-link">Mis notificaciones<div class="notification-badge" id="notification-badge">0</div></a>
    </nav>
    <div class="user-profile">Tú</div>
    <a href="login.html" class="btn-salir">Cerrar sesión</a>
  </header>

  <main>
    <!-- Sección Mi Casa -->
    <div id="mi-casa" class="content active">
      <div class="top-section">
        <div class="card">
          <h2>Tareas de Mi Casa</h2>
          <ul class="task-list" id="task-list"></ul>
        </div>

        <div class="card">
          <h2>Personas</h2>
          <ul class="person-list" id="person-list"></ul>
          <div class="add-form">
            <input type="text" id="new-person" placeholder="Nombre de la persona..." />
            <button onclick="addPerson()">Añadir Persona</button>
          </div>
        </div>
      </div>

      <div class="card">
        <h2>Resumen de Tareas Completadas</h2>
        <ul class="leaderboard-list" id="leaderboard-list"></ul>
      </div>

      <div class="card">
        <h2>Calendario de la Casa</h2>
        <div class="calendar-grid" id="house-calendar-grid">
          <div class="calendar-day"><span>1</span></div>
          <div class="calendar-day"><span>2</span></div>
          <div class="calendar-day"><span>3</span></div>
          <div class="calendar-day"><span>4</span></div>
          <div class="calendar-day"><span>5</span></div>
          <div class="calendar-day"><span>6</span></div>
          <div class="calendar-day"><span>7</span></div>
          <div class="calendar-day"><span>8</span></div>
          <div class="calendar-day"><span>9</span></div>
          <div class="calendar-day"><span>10</span></div>
          <div class="calendar-day"><span>11</span></div>
          <div class="calendar-day"><span>12</span></div>
          <div class="calendar-day"><span>13</span></div>
          <div class="calendar-day"><span>14</span></div>
          <div class="calendar-day"><span>15</span></div>
          <div class="calendar-day"><span>16</span></div>
          <div class="calendar-day"><span>17</span></div>
          <div class="calendar-day"><span>18</span></div>
          <div class="calendar-day"><span>19</span></div>
          <div class="calendar-day"><span>20</span></div>
          <div class="calendar-day"><span>21</span></div>
          <div class="calendar-day"><span>22</span></div>
          <div class="calendar-day"><span>23</span></div>
          <div class="calendar-day"><span>24</span></div>
          <div class="calendar-day"><span>25</span></div>
          <div class="calendar-day"><span>26</span></div>
          <div class="calendar-day"><span>27</span></div>
          <div class="calendar-day"><span>28</span></div>
          <div class="calendar-day"><span>29</span></div>
          <div class="calendar-day"><span>30</span></div>
          <div class="calendar-day"><span>31</span></div>
          <div class="calendar-day"></div>
          <div class="calendar-day"></div>
          <div class="calendar-day"></div>
          <div class="calendar-day"></div>
        </div>
      </div>
    </div>

    <!-- Sección Mis Tareas -->
    <div id="mis-tareas" class="content">
      <div class="card">
        <h2>Mis Tareas</h2>
        <ul class="user-task-list" id="user-task-list"></ul>
        <div class="add-form">
          <input type="text" id="new-task" placeholder="Escribe una tarea..." />
          <button onclick="addTask()">Añadir Tarea</button>
        </div>
      </div>
      <div class="card">
        <h2>Castigos</h2>
        <ul class="punishment-list" id="punishment-list"></ul>
        <button class="clear-all-btn" onclick="clearAllPunishments()">Completar todos los castigos</button>
      </div>
    </div>

    <!-- Sección Mi Calendario -->
    <div id="mi-calendario" class="content">
      <div class="card">
        <h2>Mi Calendario</h2>
        <div class="calendar-grid" id="calendar-grid">
          <div class="calendar-day"><span>1</span></div>
          <div class="calendar-day"><span>2</span></div>
          <div class="calendar-day"><span>3</span></div>
          <div class="calendar-day"><span>4</span></div>
          <div class="calendar-day"><span>5</span></div>
          <div class="calendar-day"><span>6</span></div>
          <div class="calendar-day"><span>7</span></div>
          <div class="calendar-day"><span>8</span></div>
          <div class="calendar-day"><span>9</span></div>
          <div class="calendar-day"><span>10</span></div>
          <div class="calendar-day"><span>11</span></div>
          <div class="calendar-day"><span>12</span></div>
          <div class="calendar-day"><span>13</span></div>
          <div class="calendar-day"><span>14</span></div>
          <div class="calendar-day"><span>15</span></div>
          <div class="calendar-day"><span>16</span></div>
          <div class="calendar-day"><span>17</span></div>
          <div class="calendar-day"><span>18</span></div>
          <div class="calendar-day"><span>19</span></div>
          <div class="calendar-day"><span>20</span></div>
          <div class="calendar-day"><span>21</span></div>
          <div class="calendar-day"><span>22</span></div>
          <div class="calendar-day"><span>23</span></div>
          <div class="calendar-day"><span>24</span></div>
          <div class="calendar-day"><span>25</span></div>
          <div class="calendar-day"><span>26</span></div>
          <div class="calendar-day"><span>27</span></div>
          <div class="calendar-day"><span>28</span></div>
          <div class="calendar-day"><span>29</span></div>
          <div class="calendar-day"><span>30</span></div>
          <div class="calendar-day"><span>31</span></div>
          <div class="calendar-day"></div>
          <div class="calendar-day"></div>
          <div class="calendar-day"></div>
          <div class="calendar-day"></div>
        </div>
      </div>
    </div>

    <!-- Sección Mis Notificaciones -->
    <div id="mis-notificaciones" class="content">
      <div class="card">
        <h2>Mis Notificaciones</h2>
        <ul class="notification-list" id="notification-list"></ul>
        <button class="clear-all-btn" onclick="clearAllNotifications()">Borrar todo</button>
      </div>
    </div>
  </main>

  <footer class="footer">
    © 2025 DirtyDuties - Todos los derechos reservados
  </footer>

  <div class="copy-feedback" id="copy-feedback">¡Enlace copiado al portapapeles!</div>

  <div class="modal-overlay" id="house-modal-overlay">
    <div class="house-modal">
      <h2 id="modal-title">Crear Casa</h2>
      <div class="modal-info" id="modal-info" style="display: none;">
        Hemos añadido algunas tareas típicas para tu casa. Puedes modificarlas o añadir nuevas según necesites.
      </div>
      <input type="text" id="modal-house-name" placeholder="Nombre de la casa..." />
      <textarea id="modal-house-tasks" placeholder="Tareas (una por línea, formato: Tarea - Persona)"></textarea>
      <textarea id="modal-house-people" placeholder="Personas (una por línea)"></textarea>
      <div class="modal-actions">
        <button class="cancel-btn" onclick="closeHouseModal()">Cancelar</button>
        <button class="delete-btn" id="modal-delete-btn" onclick="confirmDeleteHouse()" style="display: none;">Eliminar</button>
        <button class="save-btn" onclick="saveHouse()">Guardar</button>
      </div>
    </div>
  </div>

  <div class="modal-overlay" id="task-delete-modal-overlay">
    <div class="task-delete-modal">
      <h2>Confirmar Completado</h2>
      <p id="task-delete-message"></p>
      <div class="modal-actions">
        <button class="no-btn" onclick="closeTaskDeleteModal()">No</button>
        <button class="yes-btn" onclick="confirmTaskDelete()">Sí</button>
      </div>
    </div>
  </div>

<script>
  // Datos iniciales
  const housesData = {
    "Casa Salamanca": {
      people: ["Tú", "Lucía"],
      tasks: [
        { text: "Limpiar cocina", assignee: "Tú", completed: false, deadline: "2025-05-07", flagged: false },
        { text: "Sacar la basura", assignee: "Lucía", completed: false, deadline: "2025-05-07", flagged: false },
        { text: "Aspirar el salón", assignee: "Tú", completed: false, deadline: "2025-05-07", flagged: false },
        { text: "Lavar los platos", assignee: "Lucía", completed: false, deadline: "2025-05-07", flagged: false },
        { text: "Regar las plantas", assignee: "Tú", completed: false, deadline: "2025-05-07", flagged: false },
        { text: "Limpiar el baño", assignee: "Lucía", completed: false, deadline: "2025-05-07", flagged: false }
      ],
      userTasks: [],
      punishments: [
        {
          user: "Tú",
          taskText: "Fregar el suelo",
          reason: "No haber limpiado la casa a tiempo",
          completed: false,
          originalTask: "Limpiar cocina",
          originalDeadline: "2025-05-07",
          assignedDate: "2025-05-08"
        },
        {
          user: "Tú",
          taskText: "Limpiar ventanas",
          reason: "No haber sacado la basura a tiempo",
          completed: false,
          originalTask: "Sacar la basura",
          originalDeadline: "2025-05-06",
          assignedDate: "2025-05-07"
        },
        {
          user: "Tú",
          taskText: "Ordenar el garaje",
          reason: "No haber aspirado el salón a tiempo",
          completed: false,
          originalTask: "Aspirar el salón",
          originalDeadline: "2025-05-07",
          assignedDate: "2025-05-08"
        },
        {
          user: "Tú",
          taskText: "Lavar ropa",
          reason: "No haber regado las plantas a tiempo",
          completed: true,
          originalTask: "Regar las plantas",
          originalDeadline: "2025-05-05",
          assignedDate: "2025-05-06"
        }
      ]
    },
    "Casa del Pueblo": {
      people: ["Tú", "Pedro", "María"],
      tasks: [
        { text: "Barrer el patio", assignee: "Tú", completed: false, deadline: "2025-05-07", flagged: false },
        { text: "Limpiar ventanas", assignee: "Pedro", completed: false, deadline: "2025-05-07", flagged: false },
        { text: "Cortar el césped", assignee: "María", completed: false, deadline: "2025-05-07", flagged: false },
        { text: "Lavar ropa", assignee: "Tú", completed: false, deadline: "2025-05-07", flagged: false },
        { text: "Ordenar el garaje", assignee: "Pedro", completed: false, deadline: "2025-05-07", flagged: false },
        { text: "Limpiar la cocina", assignee: "María", completed: false, deadline: "2025-05-07", flagged: false }
      ],
      userTasks: [],
      punishments: []
    }
  };

  // Imprimir castigos en la consola para depuración
  console.log("Castigos de Casa Salamanca:", housesData["Casa Salamanca"].punishments);

  const defaultTasks = [
    "Fregar los platos - Tú",
    "Aspirar el salón - Tú",
    "Limpiar el baño - Tú",
    "Sacar la basura - Tú",
    "Regar las plantas - Tú",
    "Limpiar la cocina - Tú"
  ];

  let currentHouse = "Casa Salamanca";
  let notificationCount = 0;
  let modalMode = 'create';
  let editingHouseName = '';
  let taskToDelete = null;

  function saveToLocalStorage() {
    localStorage.setItem('housesData', JSON.stringify(housesData));
  }

  function updateNotificationCount(change) {
    notificationCount += change;
    const badge = document.getElementById('notification-badge');
    if (notificationCount > 0) {
      badge.textContent = notificationCount;
      badge.style.display = 'flex';
    } else {
      badge.style.display = 'none';
    }
  }

  function checkUncompletedTasks(houseName) {
    const houseData = housesData[houseName];
    const currentDate = new Date().toISOString().split('T')[0];

    houseData.tasks.forEach(task => {
      if (!task.completed && task.deadline <= currentDate && !task.flagged) {
        houseData.punishments = houseData.punishments || [];
        houseData.punishments.push({
          user: task.assignee,
          taskText: `Completar ${task.text}`,
          reason: `No haber completado "${task.text}" a tiempo`,
          completed: false,
          originalTask: task.text,
          originalDeadline: task.deadline,
          assignedDate: currentDate
        });
        task.flagged = true;

        const notificationList = document.getElementById('notification-list');
        const notificationItem = document.createElement('li');
        notificationItem.classList.add('notification-item');
        notificationItem.innerHTML = `
          <span>Castigo asignado: ${task.text} por no haberlo completado a tiempo</span>
          <button onclick="markPunishmentAsRead(this, '${task.text}')">Marcar como leída</button>
        `;
        notificationList.appendChild(notificationItem);
        updateNotificationCount(1);
      }
    });
    saveToLocalStorage();
  }

  function loadHouseData(houseName) {
    currentHouse = houseName;
    checkUncompletedTasks(houseName);
    const houseData = housesData[houseName];

    const taskList = document.getElementById('task-list');
    taskList.innerHTML = '';
    houseData.tasks.forEach(task => {
      const taskItem = document.createElement('li');
      taskItem.classList.add('task-item');
      if (task.completed) {
        taskItem.classList.add('completed');
      }
      taskItem.innerHTML = `
        <span>${task.text}</span>
        <span class="assignee">${task.assignee}</span>
      `;
      taskList.appendChild(taskItem);
    });

    const personList = document.getElementById('person-list');
    personList.innerHTML = '';
    houseData.people.forEach(person => {
      const personItem = document.createElement('li');
      personItem.classList.add('person-item');
      personItem.innerHTML = `<span>${person}</span>`;
      personList.appendChild(personItem);
    });

    const leaderboardList = document.getElementById('leaderboard-list');
    leaderboardList.innerHTML = '';
    houseData.people.forEach(person => {
      const completedTasks = houseData.tasks.filter(t => t.assignee === person && t.completed).length;
      const leaderboardItem = document.createElement('li');
      leaderboardItem.classList.add('leaderboard-item');
      leaderboardItem.innerHTML = `<span>${person}: ${completedTasks} tareas completadas</span>`;
      leaderboardList.appendChild(leaderboardItem);
    });

    const userTaskList = document.getElementById('user-task-list');
    userTaskList.innerHTML = '';
    const notificationList = document.getElementById('notification-list');
    notificationList.innerHTML = '';
    notificationCount = 0;

    houseData.tasks.forEach(task => {
      if (task.assignee === 'Tú' && !task.completed) {
        const userTaskItem = document.createElement('li');
        userTaskItem.classList.add('user-task-item');
        userTaskItem.dataset.type = 'house';
        userTaskItem.dataset.text = task.text;
        userTaskItem.innerHTML = `
          <input type="checkbox" class="task-checkbox">
          <span>${task.text}</span>
        `;
        userTaskList.appendChild(userTaskItem);

        const notificationItem = document.createElement('li');
        notificationItem.classList.add('notification-item');
        notificationItem.innerHTML = `
          <span>Tarea pendiente: ${task.text}</span>
          <button onclick="markNotificationAsRead(this, 'task', '${task.text}')">Marcar como leída</button>
        `;
        notificationList.appendChild(notificationItem);
        notificationCount++;
      }
    });

    houseData.userTasks.forEach(task => {
      if (task.assignee === 'Tú' && !task.completed) {
        const userTaskItem = document.createElement('li');
        userTaskItem.classList.add('user-task-item');
        userTaskItem.dataset.type = 'user';
        userTaskItem.dataset.text = task.text;
        userTaskItem.innerHTML = `
          <input type="checkbox" class="task-checkbox">
          <span>${task.text}</span>
        `;
        userTaskList.appendChild(userTaskItem);

        const notificationItem = document.createElement('li');
        notificationItem.classList.add('notification-item');
        notificationItem.innerHTML = `
          <span>Tarea pendiente: ${task.text}</span>
          <button onclick="markNotificationAsRead(this, 'task', '${task.text}')">Marcar como leída</button>
        `;
        notificationList.appendChild(notificationItem);
        notificationCount++;
      }
    });

    const punishmentList = document.getElementById('punishment-list');
    punishmentList.innerHTML = '';
    houseData.punishments = houseData.punishments || [];
    houseData.punishments.forEach(punishment => {
      if (punishment.user === 'Tú') {
        const punishmentItem = document.createElement('li');
        punishmentItem.classList.add('punishment-item');
        if (punishment.completed) {
          punishmentItem.classList.add('completed');
        }
        punishmentItem.dataset.taskText = punishment.taskText;
        punishmentItem.innerHTML = `
          <input type="checkbox" class="punishment-checkbox" ${punishment.completed ? 'checked' : ''}>
          <span>${punishment.taskText} (Motivo: ${punishment.reason})</span>
          <button class="toggle-details-btn" onclick="togglePunishmentDetails(this)">🔽</button>
          <div class="punishment-details">
            <p>Tarea original: ${punishment.originalTask}</p>
            <p>Fecha límite original: ${punishment.originalDeadline}</p>
            <p>Asignado el: ${punishment.assignedDate}</p>
          </div>
        `;
        punishmentList.appendChild(punishmentItem);

        const notificationItem = document.createElement('li');
        notificationItem.classList.add('notification-item');
        notificationItem.innerHTML = `
          <span>Castigo: ${punishment.taskText} por ${punishment.reason}</span>
          <button onclick="markPunishmentAsRead(this, '${punishment.taskText}')">Marcar como leída</button>
        `;
        notificationList.appendChild(notificationItem);
        notificationCount++;
      }
    });

    updateNotificationCount(0);

    const houseCalendarDays = document.querySelectorAll('#house-calendar-grid .calendar-day');
    houseCalendarDays.forEach(day => {
      const span = day.querySelector('span');
      day.innerHTML = '';
      if (span) day.appendChild(span);
    });
    houseData.tasks.forEach((task, index) => {
      if (!task.completed) {
        const dayIndex = (index % 31) + 1;
        const calendarDay = houseCalendarDays[dayIndex - 1];
        const taskDiv = document.createElement('div');
        taskDiv.classList.add('task');
        taskDiv.textContent = `${task.text} - ${task.assignee}`;
        calendarDay.appendChild(taskDiv);
      }
    });

    const userCalendarDays = document.querySelectorAll('#calendar-grid .calendar-day');
    userCalendarDays.forEach(day => {
      const span = day.querySelector('span');
      day.innerHTML = '';
      if (span) day.appendChild(span);
    });
    houseData.tasks.forEach((task, index) => {
      if (task.assignee === 'Tú' && !task.completed) {
        const dayIndex = (index % 31) + 1;
        const calendarDay = userCalendarDays[dayIndex - 1];
        const taskDiv = document.createElement('div');
        taskDiv.classList.add('task');
        taskDiv.textContent = `${task.text}`;
        calendarDay.appendChild(taskDiv);
      }
    });
    houseData.userTasks.forEach((task, index) => {
      if (task.assignee === 'Tú' && !task.completed) {
        const dayIndex = ((index + houseData.tasks.length) % 31) + 1;
        const calendarDay = userCalendarDays[dayIndex - 1];
        const taskDiv = document.createElement('div');
        taskDiv.classList.add('task');
        taskDiv.textContent = `${task.text}`;
        calendarDay.appendChild(taskDiv);
      }
    });
    houseData.punishments.forEach((punishment, index) => {
      if (punishment.user === 'Tú' && !punishment.completed) {
        const dayIndex = ((index + houseData.tasks.length + houseData.userTasks.length) % 31) + 1;
        const calendarDay = userCalendarDays[dayIndex - 1];
        const punishmentDiv = document.createElement('div');
        punishmentDiv.classList.add('punishment');
        punishmentDiv.textContent = `Castigo: ${punishment.taskText}`;
        calendarDay.appendChild(punishmentDiv);
      }
    });

    setupTaskCheckboxes();
    setupPunishmentCheckboxes();
  }

  document.querySelector('.sidebar-toggle').addEventListener('click', () => {
    document.querySelector('.sidebar').classList.toggle('active');
  });

  document.querySelector('.menu-toggle').addEventListener('click', () => {
    document.querySelector('.navbar nav').classList.toggle('active');
  });

  const tabs = document.querySelectorAll('.navbar nav a');
  const contents = document.querySelectorAll('.content');
  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      tabs.forEach(t => t.classList.remove('active'));
      tab.classList.add('active');

      contents.forEach(content => content.classList.remove('active'));
      document.getElementById(tab.getAttribute('data-tab')).classList.add('active');
    });
  });

  function setupTaskCheckboxes() {
    document.querySelectorAll('.user-task-item .task-checkbox').forEach(checkbox => {
      checkbox.addEventListener('change', () => {
        const taskItem = checkbox.closest('.user-task-item');
        const taskText = taskItem.dataset.text;
        const taskType = taskItem.dataset.type;

        if (checkbox.checked) {
          taskToDelete = { text: taskText, type: taskType };
          document.getElementById('task-delete-message').textContent = `¿Estás seguro de que quieres marcar la tarea "${taskText}" como completada?`;
          document.getElementById('task-delete-modal-overlay').classList.add('active');
          checkbox.checked = false;
        }
      });
    });
  }

  function setupPunishmentCheckboxes() {
    document.querySelectorAll('.punishment-item .punishment-checkbox').forEach(checkbox => {
      checkbox.addEventListener('change', () => {
        const punishmentItem = checkbox.closest('.punishment-item');
        const taskText = punishmentItem.dataset.taskText;
        if (checkbox.checked) {
          punishmentItem.classList.add('completed');
          housesData[currentHouse].punishments = housesData[currentHouse].punishments.map(p => {
            if (p.taskText === taskText && p.user === 'Tú') {
              return { ...p, completed: true };
            }
            return p;
          });
          const notificationItems = document.querySelectorAll('.notification-item span');
          notificationItems.forEach(item => {
            if (item.textContent.includes(taskText)) {
              item.closest('.notification-item').remove();
              updateNotificationCount(-1);
            }
          });
        } else {
          punishmentItem.classList.remove('completed');
          housesData[currentHouse].punishments = housesData[currentHouse].punishments.map(p => {
            if (p.taskText === taskText && p.user === 'Tú') {
              return { ...p, completed: false };
            }
            return p;
          });
        }
        saveToLocalStorage();
        loadHouseData(currentHouse);
      });
    });
  }

  function togglePunishmentDetails(button) {
    const details = button.nextElementSibling;
    details.classList.toggle('active');
    button.textContent = details.classList.contains('active') ? '🔼' : '🔽';
  }

  function addTask() {
    const taskInput = document.getElementById('new-task');
    const taskText = taskInput.value.trim();
    if (taskText === '') return;

    const newTask = { text: taskText, assignee: 'Tú', completed: false };
    housesData[currentHouse].userTasks.push(newTask);
    saveToLocalStorage();
    loadHouseData(currentHouse);
    taskInput.value = '';
  }

  function addPerson() {
    const personInput = document.getElementById('new-person');
    const personName = personInput.value.trim();
    if (personName === '') return;

    housesData[currentHouse].people.push(personName);
    saveToLocalStorage();
    loadHouseData(currentHouse);
    personInput.value = '';
  }

  function setupHouseSelection() {
    document.querySelectorAll('.house-item').forEach(item => {
      item.addEventListener('click', (e) => {
        if (e.target.tagName !== 'BUTTON') {
          document.querySelectorAll('.house-item').forEach(i => i.classList.remove('active'));
          item.classList.add('active');
          const houseName = item.getAttribute('data-house');
          loadHouseData(houseName);
        }
      });
    });
  }

  function createHouse() {
    modalMode = 'create';
    editingHouseName = '';
    document.getElementById('modal-title').textContent = 'Crear Casa';
    document.getElementById('modal-house-name').value = '';
    document.getElementById('modal-house-tasks').value = defaultTasks.join('\n');
    document.getElementById('modal-house-people').value = 'Tú';
    document.getElementById('modal-info').style.display = 'block';
    document.getElementById('modal-delete-btn').style.display = 'none';
    document.getElementById('house-modal-overlay').classList.add('active');
    document.getElementById('modal-house-name').focus();
  }

  function editHouse(button) {
    modalMode = 'edit';
    const houseItem = button.closest('.house-item');
    editingHouseName = houseItem.getAttribute('data-house');
    const houseData = housesData[editingHouseName];
    document.getElementById('modal-title').textContent = 'Editar Casa';
    document.getElementById('modal-house-name').value = editingHouseName;
    document.getElementById('modal-house-tasks').value = houseData.tasks.map(task => `${task.text} - ${task.assignee}`).join('\n');
    document.getElementById('modal-house-people').value = houseData.people.join('\n');
    document.getElementById('modal-info').style.display = 'none';
    document.getElementById('modal-delete-btn').style.display = 'inline-block';
    document.getElementById('house-modal-overlay').classList.add('active');
    document.getElementById('modal-house-name').focus();
  }

  function deleteHouse(button) {
    modalMode = 'delete';
    const houseItem = button.closest('.house-item');
    editingHouseName = houseItem.getAttribute('data-house');
    const houseData = housesData[editingHouseName];
    document.getElementById('modal-title').textContent = 'Eliminar Casa';
    document.getElementById('modal-house-name').value = editingHouseName;
    document.getElementById('modal-house-tasks').value = houseData.tasks.map(task => `${task.text} - ${task.assignee}`).join('\n');
    document.getElementById('modal-house-people').value = houseData.people.join('\n');
    document.getElementById('modal-info').style.display = 'none';
    document.getElementById('modal-delete-btn').style.display = 'inline-block';
    document.getElementById('house-modal-overlay').classList.add('active');
  }

  function closeHouseModal() {
    document.getElementById('house-modal-overlay').classList.remove('active');
  }

  function confirmDeleteHouse() {
    if (modalMode === 'delete' || modalMode === 'edit') {
      delete housesData[editingHouseName];
      const houseItem = document.querySelector(`.house-item[data-house="${editingHouseName}"]`);
      if (houseItem) houseItem.remove();
      if (currentHouse === editingHouseName) {
        const firstHouse = document.querySelector('.house-item');
        if (firstHouse) {
          firstHouse.classList.add('active');
          loadHouseData(firstHouse.getAttribute('data-house'));
        }
      }
      saveToLocalStorage();
      closeHouseModal();
    }
  }

  function saveHouse() {
    const houseName = document.getElementById('modal-house-name').value.trim();
    const tasksInput = document.getElementById('modal-house-tasks').value.trim();
    const peopleInput = document.getElementById('modal-house-people').value.trim();

    if (houseName === '') {
      alert('El nombre de la casa no puede estar vacío.');
      return;
    }

    if (modalMode === 'create' && housesData[houseName]) {
      alert('Ya existe una casa con ese nombre.');
      return;
    }

    if (modalMode === 'edit' && houseName !== editingHouseName && housesData[houseName]) {
      alert('Ya existe una casa con ese nombre.');
      return;
    }

    const deadline = new Date();
    deadline.setDate(deadline.getDate() + 7);
    const tasks = tasksInput ? tasksInput.split('\n').map(line => {
      const [text, assignee] = line.split('-').map(s => s.trim());
      return { text, assignee, completed: false, deadline: deadline.toISOString().split('T')[0], flagged: false };
    }).filter(task => task.text && task.assignee) : [];

    const people = peopleInput ? peopleInput.split('\n').map(line => line.trim()).filter(line => line) : [];

    if (modalMode === 'create') {
      housesData[houseName] = { people, tasks, userTasks: [], punishments: [] };
      const houseList = document.getElementById('house-list');
      const newHouse = document.createElement('li');
      newHouse.classList.add('house-item');
      newHouse.setAttribute('data-house', houseName);
      newHouse.innerHTML = `
        <span>${houseName}</span>
        <button onclick="editHouse(this)">✏️</button>
        <button onclick="deleteHouse(this)">🗑️</button>
        <button onclick="shareHouse(this)">🔗</button>
      `;
      houseList.appendChild(newHouse);
      setupHouseSelection();
    } else if (modalMode === 'edit') {
      if (houseName !== editingHouseName) {
        housesData[houseName] = { people, tasks, userTasks: housesData[editingHouseName].userTasks, punishments: housesData[editingHouseName].punishments };
        delete housesData[editingHouseName];
        const houseItem = document.querySelector(`.house-item[data-house="${editingHouseName}"]`);
        houseItem.querySelector('span').textContent = houseName;
        houseItem.setAttribute('data-house', houseName);
        if (currentHouse === editingHouseName) {
          currentHouse = houseName;
        }
      } else {
        housesData[houseName].people = people;
        housesData[houseName].tasks = tasks;
      }
    }

    saveToLocalStorage();
    loadHouseData(currentHouse);
    closeHouseModal();
  }

  function shareHouse(button) {
    const houseItem = button.closest('.house-item');
    const houseName = houseItem.getAttribute('data-house');
    const shareLink = `${window.location.origin}/join?house=${encodeURIComponent(houseName)}`;
    navigator.clipboard.writeText(shareLink).then(() => {
      const feedback = document.getElementById('copy-feedback');
      feedback.classList.add('show');
      setTimeout(() => feedback.classList.remove('show'), 2000);
    });
  }

  function markPunishmentAsRead(button, taskText) {
    const notificationItem = button.closest('.notification-item');
    notificationItem.remove();
    updateNotificationCount(-1);
  }

  function markNotificationAsRead(button, type, text) {
    const notificationItem = button.closest('.notification-item');
    notificationItem.remove();
    updateNotificationCount(-1);
  }

  function clearAllPunishments() {
    housesData[currentHouse].punishments = housesData[currentHouse].punishments.filter(p => p.user !== 'Tú');
    saveToLocalStorage();
    loadHouseData(currentHouse);
  }

  function closeTaskDeleteModal() {
    document.getElementById('task-delete-modal-overlay').classList.remove('active');
    taskToDelete = null;
  }

  function confirmTaskDelete() {
    if (taskToDelete) {
      const { text, type } = taskToDelete;
      const taskItem = document.querySelector(`.user-task-item[data-text="${text}"][data-type="${type}"]`);
      if (taskItem) {
        taskItem.classList.add('completed');
        taskItem.querySelector('.task-checkbox').checked = true;

        if (type === 'house') {
          housesData[currentHouse].tasks = housesData[currentHouse].tasks.map(task => {
            if (task.text === text && task.assignee === 'Tú') {
              return { ...task, completed: true };
            }
            return task;
          });
        } else if (type === 'user') {
          housesData[currentHouse].userTasks = housesData[currentHouse].userTasks.map(task => {
            if (task.text === text && task.assignee === 'Tú') {
              return { ...task, completed: true };
            }
            return task;
          });
        }

        const notificationItems = document.querySelectorAll('.notification-item span');
        notificationItems.forEach(item => {
          if (item.textContent.includes(text)) {
            item.closest('.notification-item').remove();
            updateNotificationCount(-1);
          }
        });

        saveToLocalStorage();
        loadHouseData(currentHouse);
        closeTaskDeleteModal();
      }
    }
  }

  function clearAllNotifications() {
    document.getElementById('notification-list').innerHTML = '';
    notificationCount = 0;
    updateNotificationCount(0);
  }

  setupHouseSelection();
  loadHouseData("Casa Salamanca");
</script>
</body>
</html>